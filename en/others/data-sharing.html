<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Data Sharing</title>
    <script src="https://cdn.jsdelivr.net/gh/kirakiray/ofa.js@4.3.25/dist/ofa.min.js"></script>
    <script
      src="https://cdn.jsdelivr.net/gh/kirakiray/ofa.js@4.3.25/libs/scsr/scsr.mjs"
      type="module"
    ></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/obook@2.1.28/statics/css/public.css" />
    <style>
      html,
      body {
        height: 100%;
      }
    </style>
    <script>
      let configUrl = "../config.json";
    </script>
    
        <link rel="shortcut icon" href="/favicon.png">
        <script async="" src="https://www.googletagmanager.com/gtag/js?id=G-7L1TCCJZT6"></script>
        <script>
          window.dataLayer = window.dataLayer || [];
          function gtag() {
            dataLayer.push(arguments);
          }
          gtag("js", new Date());

          gtag("config", "G-7L1TCCJZT6");
        </script>
        <script src="/init-sw.js"></script>
      
  </head>
  <body>
    <l-m src="https://cdn.jsdelivr.net/npm/obook@2.1.28/statics/comps/doc-container.html"></l-m>
    <l-m src="https://cdn.jsdelivr.net/npm/obook@2.1.28/statics/comps/doc-header/doc-header.html"></l-m>
    <o-app src="https://cdn.jsdelivr.net/npm/obook@2.1.28/statics/app-config.mjs">
      <template page>
        <style>
          .markdown-body::before,
          .markdown-body::after {
            display: block;
            content: "";
            height: 1px;
          }
          .markdown-body::after {
            height: 32px;
          }
        </style>
        <link
          rel="stylesheet"
          href="https://cdn.jsdelivr.net/npm/obook@2.1.28/statics/css/github-markdown.css"
        />
        <article class="markdown-body"><h1>Data Sharing</h1>
<p>ofa.js is different from other third-party frameworks by not adopting a traditional state management pattern. The author believes that state updates should be seamless, meaning that changing the data should automatically trigger data updates.</p>
<p>ofa.js has excellent data sharing capabilities. Its instances are developed based on the data sharing library <a href="https://github.com/kirakiray/stanz">Stanz</a>. The objects on the instances are all synchronous. If you want to achieve data sharing, you just need to create a separate Stanz object and let all components refer to it directly.</p>
<p>The following example demonstrates how to share data:</p>
<pre><code class="language-javascript">// data.mjs
export const data = $.stanz({
  val: &quot;I am shared data&quot;,
});
</code></pre>
<pre><code class="language-html">&lt;!-- comp1.html --&gt;
&lt;template component&gt;
  &lt;style&gt;
    :host {
      display: block;
      padding: 10px;
      margin: 10px;
      border: red solid 1px;
    }
  &lt;/style&gt;
  &lt;div&gt;
    {{obj}}
    &lt;br /&gt;
    comp1 =&gt;
    &lt;input type=&quot;text&quot; sync:value=&quot;obj.val&quot; /&gt;
  &lt;/div&gt;
  &lt;script&gt;
    export const tag = &quot;comp-one&quot;;
    export default async function ({ load }) {
      const { data } = await load(&quot;./data.mjs&quot;);
      return {
        data: {
          obj: {},
        },
        attached() {
          this.obj = data;
        },
        detached() {
          this.obj = null;
        },
      };
    }
  &lt;/script&gt;
&lt;/template&gt;
</code></pre>
<pre><code class="language-html">&lt;!-- comp2.html --&gt;
&lt;template component&gt;
  &lt;style&gt;
    :host {
      display: block;
      padding: 10px;
      margin: 5px;
      border: green solid 1px;
    }
  &lt;/style&gt;
  &lt;div&gt;
    &lt;span style=&quot;color: #5e5c5c; font-size: 12px;&quot;&gt;comp2&lt;/span&gt;=&gt; {{obj.val}}
  &lt;/div&gt;
  &lt;script&gt;
    export const tag = &quot;comp-two&quot;;

    export default async function ({ load }) {
      const { data } = await load(&quot;./data.mjs&quot;);

      return {
        data: {
          obj: {},
        },
        attached() {
          this.obj = data;
        },
        detached() {
          this.obj = null;
        },
      };
    }
  &lt;/script&gt;
&lt;/template&gt;
</code></pre>
<pre><code class="language-html">&lt;!-- demo.html --&gt;
&lt;!DOCTYPE html&gt;
&lt;html lang=&quot;en&quot;&gt;
  &lt;head&gt;
    &lt;meta charset=&quot;UTF-8&quot; /&gt;
    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot; /&gt;
    &lt;title&gt;data sharing&lt;/title&gt;
    &lt;script src=&quot;ofa.js&quot;&gt;&lt;/script&gt;
    &lt;l-m src=&quot;./comp1.html&quot;&gt;&lt;/l-m&gt;
    &lt;l-m src=&quot;./comp2.html&quot;&gt;&lt;/l-m&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;comp-one&gt;&lt;/comp-one&gt;
    &lt;comp-two&gt;&lt;/comp-two&gt;
    &lt;comp-two&gt;&lt;/comp-two&gt;
  &lt;/body&gt;
&lt;/html&gt;
</code></pre>
<p>In the above example, two components write data to themselves during the <code>attached</code> lifecycle. Then, the <code>obj</code> in the component becomes the shared data. After the <code>detached</code> lifecycle, the previously shared data is set to <code>null</code> to ensure data recycling.</p>
<h2>Caveat</h2>
<p>Due to data sharing, it is necessary to ensure that data is recycled at the appropriate time to avoid memory leaks.</p>
<pre><code class="language-html">&lt;template component&gt;
  comp1 =&gt;
  &lt;input type=&quot;text&quot; sync:value=&quot;obj.val&quot; /&gt;
  &lt;script&gt;
    export const tag = &quot;comp-three&quot;;

    export default async function ({ load }) {
      const { data } = await load(&quot;./data.mjs&quot;);

      return {
        data: {
        //   obj: data // ❌ This operation is wrong, setting data directly cannot be recycled
          obj: {},
        },
        ready() {
          this.obj = data; // ❌ Setting in the ready lifecycle cannot determine when to clear, which may cause memory leaks. The safest method is to set it in the attached lifecycle and delete it after detached
        },
      };
    }
  &lt;/script&gt;
&lt;/template&gt;
</code></pre>

    <article-footer></article-footer>
    </article>
        <script>
          export const parent = "https://cdn.jsdelivr.net/npm/obook@2.1.28/statics/layouts/article-layout.html";

          import pageInit from "https://cdn.jsdelivr.net/npm/obook@2.1.28/statics/document-page-init.mjs";

          export default async (...args) => {
            return await pageInit(PATH, args);
          };
        </script>
      </template>
    </o-app>
    <div id="loading"></div>
    <div class="body-important other-link"><ul>
<li><a href="../cases/index.html">Getting Started</a></li>
<li><a href="../cases/event.html">Event Handling</a></li>
<li><a href="../cases/simple-component.html">Creating and Using Components</a></li>
<li><a href="../cases/slot.html">Component Slots</a></li>
<li><a href="../cases/render-text.html">Template Syntax: Rendering Text</a></li>
<li><a href="../cases/attribute-transmission.html">Attribute Propagation</a></li>
<li><a href="../cases/get-set-comp.html">Accessing and Modifying Component Instance Values</a></li>
<li><a href="../cases/property-transmission.html">Template Syntax: Prop Binding</a></li>
<li><a href="../cases/bind-event.html">Template Syntax: Event Binding</a></li>
<li><a href="../cases/nested-component.html">Nested Components</a></li>
<li><a href="../cases/inject-host.html">inject-host Component</a></li>
<li><a href="../cases/event-passing.html">Event Propagation</a></li>
<li><a href="../cases/sync.html">Template Syntax: Two-Way Data Binding</a></li>
<li><a href="../cases/condition.html">Template Component: Conditional Rendering</a></li>
<li><a href="../cases/fill.html">Template Component: Dynamic Rendering</a></li>
<li><a href="../cases/fill-temp.html">Recursive Filling and Rendering</a></li>
<li><a href="../cases/life-cycle.html">Lifecycle</a></li>
<li><a href="../cases/form-data.html">Form Data</a></li>
<li><a href="../cases/custom-form-element.html">Custom Form Components</a></li>
<li><a href="../cases/use-page.html">Using Page Components</a></li>
<li><a href="../cases/use-app.html">Using app Component</a></li>
<li><a href="../cases/app-config.html">Configuring app Parameters</a></li>
<li><a href="../cases/app-loading.html">Customizing app Loading</a></li>
<li><a href="../cases/set404.html">Setting Up 404 Page</a></li>
<li><a href="../cases/use-hash-router.html">Using Hash Router</a></li>
<li><a href="../cases/use-scsr.html">Using SCSR Solution</a></li>
<li><a href="../docs/introduce.html">Introduction</a></li>
<li><a href="../docs/get-started/index.html">How to use ofa.js</a></li>
<li><a href="../docs/get-started/hello-world.html">First Case</a></li>
<li><a href="../docs/get-started/elements-and-events.html">Selection of Elements and Events</a></li>
<li><a href="../docs/get-started/basic-concept.html">Basic Concepts of Instances</a></li>
<li><a href="../docs/get-started/common-properties.html">Commonly Used Properties</a></li>
<li><a href="../docs/get-started/common-function.html">Introduction to Common Methods</a></li>
<li><a href="../docs/get-started/css.html">CSS</a></li>
<li><a href="../docs/get-started/classlist-and-data.html">classList and data</a></li>
<li><a href="../docs/get-started/box-model.html">Box Model</a></li>
<li><a href="../docs/get-started/formdata.html">Form Data</a></li>
<li><a href="../docs/create-component/index.html">Creation and Usage</a></li>
<li><a href="../docs/create-component/parameter-description.html">Parameter Descriptions</a></li>
<li><a href="../docs/create-component/life-cycle.html">Life Cycle</a></li>
<li><a href="../docs/create-component/web-components.html">General Knowledge of Componentization</a></li>
<li><a href="../docs/create-component/template-syntax.html">Template Syntax</a></li>
<li><a href="../docs/create-component/template-component.html">Template Components</a></li>
<li><a href="../docs/create-app/index.html">Using o-app</a></li>
<li><a href="../docs/create-app/page.html">Using Page Components</a></li>
<li><a href="../docs/create-app/app.html">Using App Components</a></li>
<li><a href="../docs/create-app/subrouting.html">Subrouting</a></li>
<li><a href="../docs/create-app/o-router.html">Route Binding</a></li>
<li><a href="../docs/create-app/scsr.html">SCSR Solution</a></li>
<li><a href="data-sharing.html">Data Sharing</a></li>
<li><a href="about-micro-frontend.html">ofa.js and Micro Frontend</a></li>
<li><a href="../../cn/index.html">简体中文-index.html</a></li>
<li><a href="../../t-cn/index.html">繁体中文-index.html</a></li>
<li><a href="../index.html">English-index.html</a></li>

</ul></div>
    <script src="https://cdn.jsdelivr.net/npm/obook@2.1.28/statics/init.js" type="module"></script>
  </body>
</html>
