<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Data Sharing</title>
    <script src="https://cdn.jsdelivr.net/gh/kirakiray/ofa.js@4.3.16/dist/ofa.min.js"></script>
    <script
      src="https://cdn.jsdelivr.net/gh/kirakiray/ofa.js@4.3.16/libs/scsr/scsr.mjs"
      type="module"
    ></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/obook@2.1.14/statics/css/public.css" />
    <style>
      html,
      body {
        height: 100%;
      }
    </style>
    <script>
      let configUrl = "../config.json";
    </script>
    
        <script async="" src="https://www.googletagmanager.com/gtag/js?id=G-7L1TCCJZT6"></script>
        <script>
          window.dataLayer = window.dataLayer || [];
          function gtag() {
            dataLayer.push(arguments);
          }
          gtag("js", new Date());

          gtag("config", "G-7L1TCCJZT6");
        </script>
        <script src="/init-sw.js"></script>
      
  </head>
  <body>
    <l-m src="https://cdn.jsdelivr.net/npm/obook@2.1.14/statics/comps/doc-container.html"></l-m>
    <l-m src="https://cdn.jsdelivr.net/npm/obook@2.1.14/statics/comps/doc-header/doc-header.html"></l-m>
    <o-app src="https://cdn.jsdelivr.net/npm/obook@2.1.14/statics/app-config.mjs">
      <template page>
        <style>
          .markdown-body::before,
          .markdown-body::after {
            display: block;
            content: "";
            height: 1px;
          }
          .markdown-body::after {
            height: 32px;
          }
        </style>
        <link
          rel="stylesheet"
          href="https://cdn.jsdelivr.net/npm/obook@2.1.14/statics/css/github-markdown.css"
        />
        <article class="markdown-body"><h1>Data Sharing</h1>
<p>ofa.js is different from other third-party frameworks as it does not use traditional state management patterns. The author believes that state updates should be transparent, meaning that data updates should automatically trigger updates. </p>
<p>ofa.js inherently possesses excellent data sharing capabilities, as its instances are developed based on the data sharing library <a href="https://github.com/kirakiray/stanz">Stanz</a>. Objects on instances are all synchronizable. To achieve data sharing, simply create a separate Stanz object and have all components directly reference it.</p>
<p>The following example illustrates how to share data:</p>
<pre><code class="language-javascript">// data.mjs
export const data = $.stanz({
  val: &quot;I am shared data&quot;,
});
</code></pre>
<pre><code class="language-html">&lt;!-- comp1.html --&gt;
&lt;template component&gt;
  &lt;style&gt;
    :host {
      display: block;
      padding: 10px;
      margin: 10px;
      border: red solid 1px;
    }
  &lt;/style&gt;
  &lt;div&gt;
    {{obj}}
    &lt;br /&gt;
    comp1 =&gt;
    &lt;input type=&quot;text&quot; sync:value=&quot;obj.val&quot; /&gt;
  &lt;/div&gt;
  &lt;script&gt;
    export const tag = &quot;comp-one&quot;;

    export default async function ({ load }) {
      const { data } = await load(&quot;./data.mjs&quot;);

      return {
        data: {
          obj: {},
        },
        attached() {
          this.obj = data;
        },
        detached() {
          this.obj = null;
        },
      };
    }
  &lt;/script&gt;
&lt;/template&gt;
</code></pre>
<pre><code class="language-html">&lt;!-- comp2.html --&gt;
&lt;template component&gt;
  &lt;style&gt;
    :host {
      display: block;
      padding: 10px;
      margin: 5px;
      border: green solid 1px;
    }
  &lt;/style&gt;
  &lt;div&gt;
    &lt;span style=&quot;color: #5e5c5c; font-size: 12px;&quot;&gt;comp2&lt;/span&gt;=&gt; {{obj.val}}
  &lt;/div&gt;
  &lt;script&gt;
    export const tag = &quot;comp-two&quot;;

    export default async function ({ load }) {
      const { data } = await load(&quot;./data.mjs&quot;);

      return {
        data: {
          obj: {},
        },
        attached() {
          this.obj = data;
        },
        detached() {
          this.obj = null;
        },
      };
    }
  &lt;/script&gt;
&lt;/template&gt;
</code></pre>
<pre><code class="language-html">&lt;!-- demo.html --&gt;
&lt;!DOCTYPE html&gt;
&lt;html lang=&quot;en&quot;&gt;
  &lt;head&gt;
    &lt;meta charset=&quot;UTF-8&quot; /&gt;
    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot; /&gt;
    &lt;title&gt;data sharing&lt;/title&gt;
    &lt;script src=&quot;ofa.js&quot;&gt;&lt;/script&gt;
    &lt;l-m src=&quot;./comp1.html&quot;&gt;&lt;/l-m&gt;
    &lt;l-m src=&quot;./comp2.html&quot;&gt;&lt;/l-m&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;comp-one&gt;&lt;/comp-one&gt;
    &lt;comp-two&gt;&lt;/comp-two&gt;
    &lt;comp-two&gt;&lt;/comp-two&gt;
  &lt;/body&gt;
&lt;/html&gt;
</code></pre>
<p>In the above example, when the two components are in the <code>attached</code> lifecycle, they write data to the component itself. Then, the <code>obj</code> of the component becomes the shared data. After the <code>detached</code> lifecycle, the previously shared data is set to <code>null</code> to ensure that the data is reclaimed.</p>
<h2>Precautions</h2>
<p>Since the data is shared, it is necessary to ensure that the data is reclaimed at the appropriate time to avoid memory leaks.</p>
<pre><code class="language-html">&lt;template component&gt;
  comp1 =&gt;
  &lt;input type=&quot;text&quot; sync:value=&quot;obj.val&quot; /&gt;
  &lt;script&gt;
    export const tag = &quot;comp-three&quot;;

    export default async function ({ load }) {
      const { data } = await load(&quot;./data.mjs&quot;);

      return {
        data: {
        //   obj: data // ❌ This operation is incorrect, directly setting the data cannot be reclaimed
          obj: {},
        },
        ready() {
          this.obj = data; // ❌ Setting it in the ready lifecycle is uncertain when it will be cleared, which may cause memory leaks. The safest method is to set it in the attached lifecycle and delete it after detached
        },
      };
    }
  &lt;/script&gt;
&lt;/template&gt;
</code></pre>

    <article-footer></article-footer>
    </article>
        <script>
          export const parent = "https://cdn.jsdelivr.net/npm/obook@2.1.14/statics/layouts/article-layout.html";

          import pageInit from "https://cdn.jsdelivr.net/npm/obook@2.1.14/statics/document-page-init.mjs";

          export default async (...args) => {
            return await pageInit(PATH, args);
          };
        </script>
      </template>
    </o-app>
    <div id="loading"></div>
    <script src="https://cdn.jsdelivr.net/npm/obook@2.1.14/statics/init.js" type="module"></script>
  </body>
</html>
